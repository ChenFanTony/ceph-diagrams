<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36" version="29.2.7">
  <diagram name="第 1 页" id="jUwy29AcYQmpEwm30NJZ">
    <mxGraphModel dx="1416" dy="763" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="sjxD1XnoycQuhz903Nwa-19" edge="1" parent="1" source="sjxD1XnoycQuhz903Nwa-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.75;exitDx=0;exitDy=0;entryX=0.25;entryY=1;entryDx=0;entryDy=0;" target="sjxD1XnoycQuhz903Nwa-4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-20" connectable="0" parent="sjxD1XnoycQuhz903Nwa-19" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="Key id" vertex="1">
          <mxGeometry relative="1" x="0.809" y="-2" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-1" parent="1" style="rounded=1;whiteSpace=wrap;html=1;" value="barbicon sever" vertex="1">
          <mxGeometry height="60" width="120" x="550" y="410" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-3" edge="1" parent="1" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;rounded=0;" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="460" y="1300" as="sourcePoint" />
            <mxPoint x="460" y="320" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-16" edge="1" parent="1" source="sjxD1XnoycQuhz903Nwa-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="340" y="430" />
            </Array>
            <mxPoint x="550" y="430" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-17" connectable="0" parent="sjxD1XnoycQuhz903Nwa-16" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="lib: Castellan API" vertex="1">
          <mxGeometry relative="1" x="-0.8759" y="-1" as="geometry">
            <mxPoint x="111" y="34" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-21" connectable="0" parent="sjxD1XnoycQuhz903Nwa-16" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="(args: cipher, size)" vertex="1">
          <mxGeometry relative="1" x="-0.4759" y="3" as="geometry">
            <mxPoint y="-17" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-4" parent="1" style="rounded=1;whiteSpace=wrap;html=1;" value="cinder" vertex="1">
          <mxGeometry height="50" width="120" x="250" y="330" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-43" edge="1" parent="1" source="sjxD1XnoycQuhz903Nwa-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" target="sjxD1XnoycQuhz903Nwa-42">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-46" connectable="0" parent="sjxD1XnoycQuhz903Nwa-43" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="initial connection" vertex="1">
          <mxGeometry relative="1" x="0.0278" y="2" as="geometry">
            <mxPoint x="15" y="2" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-48" edge="1" parent="1" source="sjxD1XnoycQuhz903Nwa-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;startArrow=classic;startFill=1;endArrow=none;endFill=0;" target="sjxD1XnoycQuhz903Nwa-47">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="310" y="1120" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-50" connectable="0" parent="sjxD1XnoycQuhz903Nwa-48" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="1. get passphase(args key id)" vertex="1">
          <mxGeometry relative="1" x="-0.2755" y="1" as="geometry">
            <mxPoint x="39" y="-4" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-5" parent="1" style="rounded=1;whiteSpace=wrap;html=1;" value="nova" vertex="1">
          <mxGeometry height="60" width="120" x="250" y="1040" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-6" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;" value="阶段一:" vertex="1">
          <mxGeometry height="30" width="60" x="30" y="60" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-12" edge="1" parent="1" source="sjxD1XnoycQuhz903Nwa-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="sjxD1XnoycQuhz903Nwa-11" value="">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-7" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;" value="创建新的 volume_type 云硬盘类型, 根据已有的类型填写backend name , 并勾选 &quot;加密属性&quot; (lic 控制)" vertex="1">
          <mxGeometry height="50" width="310" x="100" y="130" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-8" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;" value="通过加密云盘类型来创建加密云盘" vertex="1">
          <mxGeometry height="30" width="100" x="100" y="290" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-11" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;" value="默认指定加密luks v1 的 cipher +&amp;nbsp; size 为: 如 aes + 256" vertex="1">
          <mxGeometry height="40" width="340" x="85" y="210" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-13" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;" value="块存储云产品安装时,&amp;nbsp; license指定是否支持加密功能" vertex="1">
          <mxGeometry height="40" width="300" x="100" y="55" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-14" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;" value="阶段二:" vertex="1">
          <mxGeometry height="30" width="60" x="30" y="140" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-15" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;" value="阶段三:" vertex="1">
          <mxGeometry height="30" width="60" x="30" y="280" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-22" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;" value="db: key id 绑定 volume uuid" vertex="1">
          <mxGeometry height="30" width="150" x="85" y="360" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-23" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;" value="step 1:" vertex="1">
          <mxGeometry height="30" width="60" x="110" y="330" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-24" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;" value="step 2:" vertex="1">
          <mxGeometry height="30" width="60" x="110" y="500" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-26" edge="1" parent="1" source="sjxD1XnoycQuhz903Nwa-25" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;startArrow=classic;startFill=1;endArrow=none;endFill=0;entryX=0.433;entryY=1;entryDx=0;entryDy=0;entryPerimeter=0;" target="sjxD1XnoycQuhz903Nwa-1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="310" y="590" />
              <mxPoint x="600" y="590" />
              <mxPoint x="600" y="470" />
            </Array>
            <mxPoint x="300" y="560" as="sourcePoint" />
            <mxPoint x="600" y="480" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-27" connectable="0" parent="sjxD1XnoycQuhz903Nwa-26" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="&lt;span style=&quot;color: rgba(0, 0, 0, 0); font-family: monospace; font-size: 0px; text-align: start; background-color: rgb(236, 236, 236);&quot;&gt;%3CmxGraphModel%3E%3Croot%3E%3CmxCell%20id%3D%220%22%2F%3E%3CmxCell%20id%3D%221%22%20parent%3D%220%22%2F%3E%3CmxCell%20id%3D%222%22%20connectable%3D%220%22%20parent%3D%221%22%20style%3D%22edgeLabel%3Bhtml%3D1%3Balign%3Dcenter%3BverticalAlign%3Dmiddle%3Bresizable%3D0%3Bpoints%3D%5B%5D%3B%22%20value%3D%22lib%3A%20Castellan%20API%22%20vertex%3D%221%22%3E%3CmxGeometry%20x%3D%22450%22%20y%3D%22430%22%20as%3D%22geometry%22%2F%3E%3C%2FmxCell%3E%3C%2Froot%3E%3C%2FmxGraphModel%3E&lt;/span&gt;" vertex="1">
          <mxGeometry relative="1" x="-0.2" y="1" as="geometry">
            <mxPoint x="8" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-28" connectable="0" parent="sjxD1XnoycQuhz903Nwa-26" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="get: (arg: key id)" vertex="1">
          <mxGeometry relative="1" x="-0.7143" y="4" as="geometry">
            <mxPoint y="-6" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-37" connectable="0" parent="sjxD1XnoycQuhz903Nwa-26" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="lib: Castellan API" vertex="1">
          <mxGeometry relative="1" x="-0.1708" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-25" parent="1" style="rounded=1;whiteSpace=wrap;html=1;" value="cinder" vertex="1">
          <mxGeometry height="50" width="120" x="250" y="500" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-30" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;" value="根据key id 获取密钥(明文)" vertex="1">
          <mxGeometry height="30" width="160" x="75" y="530" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-31" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;" value="step 3.1:" vertex="1">
          <mxGeometry height="30" width="60" x="110" y="670" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-32" parent="1" style="rounded=1;whiteSpace=wrap;html=1;" value="cinder" vertex="1">
          <mxGeometry height="50" width="120" x="250" y="630" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-33" parent="1" style="rounded=1;whiteSpace=wrap;html=1;" value="后端存储" vertex="1">
          <mxGeometry height="60" width="120" x="540" y="820" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-34" edge="1" parent="1" source="sjxD1XnoycQuhz903Nwa-32" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" target="sjxD1XnoycQuhz903Nwa-33">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="310" y="850" />
            </Array>
            <mxPoint x="530" y="710" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-35" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;rounded=0;" value="创建加密云盘:&amp;nbsp;虚机里面看到的和大小是和非加密盘一样的，不会损失用户实际可用空间.&lt;br&gt;1. 不同的驱动实现:&lt;br&gt;rbd: 实现 create_volume 接口, 在接口中通过密钥+ cipher初始化luks卷, 卷大小包含了luks header 大小.&amp;nbsp;&lt;br&gt;&lt;br&gt;iscsi: 默认创建卷时不生成包含luks头的卷. 卷大小为实际创盘大小, 因此相对rbd 磁盘大小小luks header 大小." vertex="1">
          <mxGeometry height="130" width="360" x="75" y="710" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-39" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;" value="step 3.2:" vertex="1">
          <mxGeometry height="30" width="60" x="110" y="860" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-40" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;rounded=0;" value="创建系统盘:&amp;nbsp;&lt;br&gt;1. 不同的驱动实现:&lt;br&gt;rbd: 基于3.1, 实现 copy_image_to_volume 接口, 通过cinder节点将image (未加密) down下来, copy image到volume中, 最后再卸载.&lt;br&gt;&lt;br&gt;iscsi: XX?" vertex="1">
          <mxGeometry height="130" width="360" x="75" y="890" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-41" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;" value="step 4:" vertex="1">
          <mxGeometry height="30" width="60" x="110" y="1100" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-42" parent="1" style="rounded=1;whiteSpace=wrap;html=1;" value="后端存储" vertex="1">
          <mxGeometry height="60" width="120" x="550" y="1160" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-47" parent="1" style="rounded=1;whiteSpace=wrap;html=1;" value="barbicon sever" vertex="1">
          <mxGeometry height="60" width="120" x="550" y="1085" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-49" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;" value="挂载系统盘/云盘&lt;br&gt;1.&amp;nbsp;" vertex="1">
          <mxGeometry height="30" width="115" x="75" y="1139" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
