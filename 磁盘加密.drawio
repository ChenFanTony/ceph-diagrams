<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36" version="29.2.7">
  <diagram name="第 1 页" id="jUwy29AcYQmpEwm30NJZ">
    <mxGraphModel dx="1416" dy="763" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="sjxD1XnoycQuhz903Nwa-19" edge="1" parent="1" source="sjxD1XnoycQuhz903Nwa-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.75;exitDx=0;exitDy=0;entryX=0.25;entryY=1;entryDx=0;entryDy=0;" target="sjxD1XnoycQuhz903Nwa-4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-20" connectable="0" parent="sjxD1XnoycQuhz903Nwa-19" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="Key id" vertex="1">
          <mxGeometry relative="1" x="0.809" y="-2" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-1" parent="1" style="rounded=1;whiteSpace=wrap;html=1;" value="barbicon sever" vertex="1">
          <mxGeometry height="60" width="120" x="550" y="410" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-3" edge="1" parent="1" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;rounded=0;" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="460" y="1870" as="sourcePoint" />
            <mxPoint x="460" y="320" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-16" edge="1" parent="1" source="sjxD1XnoycQuhz903Nwa-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="340" y="430" />
            </Array>
            <mxPoint x="550" y="430" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-17" connectable="0" parent="sjxD1XnoycQuhz903Nwa-16" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="lib: Castellan API" vertex="1">
          <mxGeometry relative="1" x="-0.8759" y="-1" as="geometry">
            <mxPoint x="111" y="34" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-21" connectable="0" parent="sjxD1XnoycQuhz903Nwa-16" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="(args: cipher, size)" vertex="1">
          <mxGeometry relative="1" x="-0.4759" y="3" as="geometry">
            <mxPoint y="-17" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-4" parent="1" style="rounded=1;whiteSpace=wrap;html=1;" value="cinder" vertex="1">
          <mxGeometry height="50" width="120" x="250" y="330" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-43" edge="1" parent="1" source="sjxD1XnoycQuhz903Nwa-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" target="sjxD1XnoycQuhz903Nwa-42">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-46" connectable="0" parent="sjxD1XnoycQuhz903Nwa-43" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="3. initial connection" vertex="1">
          <mxGeometry relative="1" x="0.0278" y="2" as="geometry">
            <mxPoint x="75" y="2" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-48" edge="1" parent="1" source="sjxD1XnoycQuhz903Nwa-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;startArrow=classic;startFill=1;endArrow=none;endFill=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" target="sjxD1XnoycQuhz903Nwa-47">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="310" y="1500" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-50" connectable="0" parent="sjxD1XnoycQuhz903Nwa-48" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="2. get passphase(args key id)" vertex="1">
          <mxGeometry relative="1" x="-0.2755" y="1" as="geometry">
            <mxPoint x="105" y="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-5" parent="1" style="rounded=1;whiteSpace=wrap;html=1;" value="nova" vertex="1">
          <mxGeometry height="60" width="120" x="250" y="1360" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-6" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;" value="阶段一:" vertex="1">
          <mxGeometry height="30" width="60" x="30" y="60" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-12" edge="1" parent="1" source="sjxD1XnoycQuhz903Nwa-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="sjxD1XnoycQuhz903Nwa-11" value="">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-7" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;" value="创建新的 volume_type 云硬盘类型, 根据已有的类型填写backend name , 并勾选 &quot;加密属性&quot; (lic 控制)" vertex="1">
          <mxGeometry height="50" width="310" x="100" y="130" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-8" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;rounded=0;" value="通过加密云盘类型来创建加密云盘" vertex="1">
          <mxGeometry height="30" width="100" x="100" y="290" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-11" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;" value="默认指定加密luks v2 的 cipher +&amp;nbsp; size 为: 如 aes + 256" vertex="1">
          <mxGeometry height="40" width="340" x="85" y="210" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-13" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;" value="块存储云产品安装时,&amp;nbsp; license指定块存储云产品是否支持加密功能" vertex="1">
          <mxGeometry height="40" width="370" x="100" y="55" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-14" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;" value="阶段二:" vertex="1">
          <mxGeometry height="30" width="60" x="30" y="140" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-15" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;" value="阶段三:" vertex="1">
          <mxGeometry height="30" width="60" x="30" y="310" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-22" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;rounded=0;" value="选择云盘类型创建云盘, 可支持自定义密钥, 绑定云盘和已创建的密钥后, db自动保存: key id 绑定 volume uuid" vertex="1">
          <mxGeometry height="30" width="205" x="47.5" y="390" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-23" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;" value="step 1:" vertex="1">
          <mxGeometry height="30" width="60" x="110" y="340" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-24" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;" value="step 2:" vertex="1">
          <mxGeometry height="30" width="60" x="110" y="500" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-26" edge="1" parent="1" source="sjxD1XnoycQuhz903Nwa-25" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;startArrow=classic;startFill=1;endArrow=none;endFill=0;entryX=0.433;entryY=1;entryDx=0;entryDy=0;entryPerimeter=0;" target="sjxD1XnoycQuhz903Nwa-1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="310" y="590" />
              <mxPoint x="600" y="590" />
              <mxPoint x="600" y="470" />
            </Array>
            <mxPoint x="300" y="560" as="sourcePoint" />
            <mxPoint x="600" y="480" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-27" connectable="0" parent="sjxD1XnoycQuhz903Nwa-26" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="&lt;span style=&quot;color: rgba(0, 0, 0, 0); font-family: monospace; font-size: 0px; text-align: start; background-color: rgb(236, 236, 236);&quot;&gt;%3CmxGraphModel%3E%3Croot%3E%3CmxCell%20id%3D%220%22%2F%3E%3CmxCell%20id%3D%221%22%20parent%3D%220%22%2F%3E%3CmxCell%20id%3D%222%22%20connectable%3D%220%22%20parent%3D%221%22%20style%3D%22edgeLabel%3Bhtml%3D1%3Balign%3Dcenter%3BverticalAlign%3Dmiddle%3Bresizable%3D0%3Bpoints%3D%5B%5D%3B%22%20value%3D%22lib%3A%20Castellan%20API%22%20vertex%3D%221%22%3E%3CmxGeometry%20x%3D%22450%22%20y%3D%22430%22%20as%3D%22geometry%22%2F%3E%3C%2FmxCell%3E%3C%2Froot%3E%3C%2FmxGraphModel%3E&lt;/span&gt;" vertex="1">
          <mxGeometry relative="1" x="-0.2" y="1" as="geometry">
            <mxPoint x="8" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-28" connectable="0" parent="sjxD1XnoycQuhz903Nwa-26" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="get: (arg: key id)" vertex="1">
          <mxGeometry relative="1" x="-0.7143" y="4" as="geometry">
            <mxPoint y="-6" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-37" connectable="0" parent="sjxD1XnoycQuhz903Nwa-26" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="lib: Castellan API" vertex="1">
          <mxGeometry relative="1" x="-0.1708" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-25" parent="1" style="rounded=1;whiteSpace=wrap;html=1;" value="cinder" vertex="1">
          <mxGeometry height="50" width="120" x="250" y="500" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-30" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;" value="根据key id 获取密钥(明文)" vertex="1">
          <mxGeometry height="30" width="160" x="45" y="530" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-31" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;" value="step 3.1:" vertex="1">
          <mxGeometry height="30" width="60" x="110" y="650" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-32" parent="1" style="rounded=1;whiteSpace=wrap;html=1;" value="cinder" vertex="1">
          <mxGeometry height="50" width="120" x="255" y="630" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-33" parent="1" style="rounded=1;whiteSpace=wrap;html=1;" value="后端存储" vertex="1">
          <mxGeometry height="60" width="120" x="545" y="820" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-34" edge="1" parent="1" source="sjxD1XnoycQuhz903Nwa-32" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" target="sjxD1XnoycQuhz903Nwa-33">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="315" y="850" />
            </Array>
            <mxPoint x="535" y="710" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-35" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;rounded=0;" value="创建加密云盘:&amp;nbsp;虚机里面看到的和大小是和非加密盘一样的，不会损失用户实际可用空间.&lt;br&gt;1. 不同的驱动实现:&amp;nbsp; &amp;nbsp;&lt;font style=&quot;color: rgb(204, 0, 0);&quot;&gt;XXX&lt;/font&gt;&lt;br&gt;rbd: 实现 create_volume 接口, 在接口中通过密钥+ cipher初始化luks卷, 卷大小包含了luks header 大小.&amp;nbsp;&lt;br&gt;&lt;br&gt;iscsi: 默认创建卷时不生成包含luks头的卷. 卷大小为实际创盘大小, 因此相对rbd 磁盘大小小luks header 大小." vertex="1">
          <mxGeometry height="130" width="360" x="50" y="690" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-39" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;" value="step 3.2:" vertex="1">
          <mxGeometry height="30" width="60" x="115" y="860" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-40" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;rounded=0;" value="创建系统盘:&amp;nbsp;&lt;br&gt;1. 不同的驱动实现:&lt;br&gt;rbd: 包含 step 3.1,实现 copy_image_to_volume 接口, 通过cinder控制节点将image (未加密) down下来,&amp;nbsp; 创建/选择自定义密钥, image 转换成加密镜像, 才 rbd import to volume.&lt;br&gt;&lt;br&gt;iscsi: 包含 step 3.1, cinder通过 os-brick 父类 copy_image_to_volume 实现, 通过cinder控制节点将 image (未加密) down下来, 创建/选择自定义密钥, 挂载存储卷后,&amp;nbsp;会执行format luks卷, 然后 copy image(未加密)到volume中, 最后再卸载." vertex="1">
          <mxGeometry height="130" width="520" x="50" y="890" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-42" parent="1" style="rounded=1;whiteSpace=wrap;html=1;" value="后端存储" vertex="1">
          <mxGeometry height="60" width="120" x="550" y="1540" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-47" parent="1" style="rounded=1;whiteSpace=wrap;html=1;" value="barbicon sever" vertex="1">
          <mxGeometry height="60" width="120" x="550" y="1470" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-49" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;rounded=0;" value="nova挂载系统盘/云盘时, 根据volume信息, 获取密钥明文 +云盘类型cipher+size, 先创建secret xml,&amp;nbsp;调用后端驱动 intial connection 挂载云盘.&amp;nbsp;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;qemu&lt;/span&gt;启动&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;时, 绑定secret到卷, 读写磁盘时qemu 加密驱动拦截io 对卷进行encode/decode.&lt;/span&gt;" vertex="1">
          <mxGeometry height="100" width="280" x="30" y="1420" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-52" edge="1" parent="1" source="sjxD1XnoycQuhz903Nwa-51" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" target="sjxD1XnoycQuhz903Nwa-5">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-53" connectable="0" parent="sjxD1XnoycQuhz903Nwa-52" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="1. get cipher + size, key id" vertex="1">
          <mxGeometry relative="1" x="0.2928" y="2" as="geometry">
            <mxPoint x="23" y="-7" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-51" parent="1" style="rounded=1;whiteSpace=wrap;html=1;" value="cinder" vertex="1">
          <mxGeometry height="50" width="120" x="550" y="1365" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-54" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;" value="其他" vertex="1">
          <mxGeometry height="30" width="60" x="47.5" y="1570" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-55" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;rounded=0;" value="通过加密镜像创建系统盘:&amp;nbsp;&lt;br&gt;1. 上传加密镜像&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; 用户上传加密镜像, 需要镜像文件和密钥, 镜像文件可以通过glance 上传,并要设置 cipher + size + key id, &lt;font style=&quot;color: rgb(204, 0, 0);&quot;&gt;然后密钥需要上传到babican (*证书和密钥云产品*)&lt;/font&gt;&lt;br&gt;2. 从加密云盘转换成加密镜像, 自动设置&amp;nbsp;cipher + size + key id, barbican 默认已有keyid 继承自云盘.&lt;br&gt;&lt;div&gt;&lt;br&gt;创建系统盘时:&lt;br&gt;rbd:&amp;nbsp;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;包含 step 3.1, 实现 copy_image_to_volume 接口, 通过cinder控制节点将image (加密) down下来, 直接 rbd import to volume. 密钥为更新成镜像密钥, 那么就不支持自定义密钥(rbd 暂时不支持).&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;iscsi:&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;包含 step 3.1, cinder通过 os-brick 父类 copy_image_to_volume 实现, 通过cinder控制节点将 image (加密) down下来, 挂载存储卷后, 直接 copy image(加密)到volume中, 最后再卸载. 密钥为镜像密钥, 不支持自定义密钥. (&lt;/span&gt;&lt;span style=&quot;background-color: transparent;&quot;&gt;&lt;font style=&quot;color: light-dark(rgb(204, 0, 0), rgb(204, 0, 0));&quot;&gt;但是iscsi这种可以通过挂载, cryptosetup changekey来修改密钥&lt;/font&gt;&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;)&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;font style=&quot;color: light-dark(rgb(204, 0, 0), rgb(204, 0, 0));&quot;&gt;#%%&lt;/font&gt; 华为: evs 支持在创建系统盘的时候如果指定密钥, 系统会覆盖加密镜像密钥.&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;/span&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="270" width="635" x="47.5" y="1000" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-58" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;" value="阶段四:" vertex="1">
          <mxGeometry height="30" width="60" x="40" y="1380" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-59" parent="1" style="rounded=1;whiteSpace=wrap;html=1;" value="glance" vertex="1">
          <mxGeometry height="50" width="120" x="550" y="1270" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-60" edge="1" parent="1" source="sjxD1XnoycQuhz903Nwa-51" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" target="sjxD1XnoycQuhz903Nwa-59">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="610" y="1330" />
              <mxPoint x="610" y="1330" />
            </Array>
            <mxPoint x="690" y="935" as="sourcePoint" />
            <mxPoint x="615" y="1140" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-61" connectable="0" parent="sjxD1XnoycQuhz903Nwa-60" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="系统盘: get cipher + size, key id" vertex="1">
          <mxGeometry relative="1" x="0.2928" y="2" as="geometry">
            <mxPoint x="2" y="4" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-62" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;rounded=0;" value="&lt;div style=&quot;&quot;&gt;&lt;div&gt;&lt;font style=&quot;color: rgb(0, 0, 0);&quot;&gt;1. 快照接口不需要特殊处理, 密钥继承原盘.&amp;nbsp; 从快照创建新卷, 是否可以更改密钥 ?&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#cc0000&quot;&gt;#%% 阿里云 可以更改密钥; 阿里云对密钥分2中, 平台自动创建的叫服务密钥, 导入或其他叫主密钥 华为云: 用户的主密钥CMK（Customer Master Key），第二层级为数据密钥DK（Data Key）&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#cc0000&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font style=&quot;color: rgb(0, 0, 0);&quot;&gt;2. 克隆接口, 默认密钥继承原盘, 考虑可以修改密钥?&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font style=&quot;color: rgb(0, 0, 0);&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font style=&quot;color: rgb(0, 0, 0);&quot;&gt;2. get_volume_stats 不会特殊处理&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font style=&quot;color: rgb(0, 0, 0);&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font style=&quot;color: rgb(0, 0, 0);&quot;&gt;3. 扩容磁盘大小可能要特别处理&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font style=&quot;color: rgb(0, 0, 0);&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font style=&quot;color: rgb(0, 0, 0);&quot;&gt;4. 盘删掉了, 密钥会自动删除&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="130" width="515" x="45" y="1630" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-64" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;rounded=0;fontColor=#CC0000;" value="&lt;font style=&quot;&quot;&gt;&lt;b&gt;需支持自定义密钥/导入密钥&lt;/b&gt;&lt;br&gt;&lt;b&gt;加密类型: ENCRYPT_DECRYPT&lt;br&gt;支持算法: AES + 256 / SM2&lt;/b&gt;&lt;br&gt;&lt;b&gt;其他高级功能: 如计划删除密钥, 密钥更新等&amp;nbsp;&lt;br&gt;依赖关系: 删除密钥时如果有引用需要提示&lt;/b&gt;&lt;/font&gt;" vertex="1">
          <mxGeometry height="30" width="260" x="530" y="500" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-68" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;rounded=0;" value="5. 克隆云主机, 密钥会被替换: 默认 clone_volume 会原盘自动替换成新的密钥, 基于cryptsetup changekey 命令, 目前只iscsi 支持替换密钥, 而rbd 没有替换" vertex="1">
          <mxGeometry height="50" width="300" x="42.5" y="1800" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-69" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;rounded=0;" value="luks替换密钥: 是否存在数据重写风险&lt;br&gt;1. slot id 被overwrite&lt;br&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;2. 8 个 slot id, openstack / qemu 是否支持多slot 加密&lt;/span&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="60" width="490" x="55" y="1990" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-70" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;" value="疑问点:" vertex="1">
          <mxGeometry height="30" width="60" x="40" y="1950" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-71" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;rounded=0;" value="当前对于加密云盘的key 列表不显示" vertex="1">
          <mxGeometry height="30" width="130" x="550" y="360" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-73" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;" value="产品说明/限制:" vertex="1">
          <mxGeometry height="30" width="110" x="40" y="2070" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-74" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;rounded=0;" value="1.&amp;nbsp;密钥丢失后数据永远无法修复" vertex="1">
          <mxGeometry height="30" width="330" x="55" y="2100" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-75" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;rounded=0;" value="6. 备份云产品, 备份和恢复功能, 对于加密盘数据不感知, 可支持&lt;br&gt;7. 跨存储迁移, 类似备份云产品也可以支持" vertex="1">
          <mxGeometry height="110" width="290" x="40" y="1840" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-76" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;rounded=0;" value="其他功能说明:&lt;br&gt;1.&amp;nbsp;将非加密云盘转换为加密云盘 : 不需要支持&lt;br&gt;#%%: 将非加密快照复制成加密快照, 或复制加密自定义镜像完成&lt;br&gt;#%%:&amp;nbsp;&lt;span style=&quot;background-color: transparent;&quot;&gt;转换数据加密状态:&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;如果您需要对云硬盘现有数据从非加密状态转换为加密状态，建议您使用 Linux 下的 rsync 命令或者 Windows 下的&amp;nbsp; robocopy 命令，将数据从非加密盘复制到新创建的加密盘上。&lt;/span&gt;&lt;div&gt;如果您需要对云硬盘现有数据从加密状态转换为非加密状态，则建议您使用相同命令将数据从加密盘复制到新创建的非加密盘上。&lt;/div&gt;&lt;div&gt;2. 加密原理要补充&lt;br&gt;3. LVM的盘, 驱动是否支持加密?&lt;br&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="150" width="330" x="480" y="1960" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-78" edge="1" parent="1" source="sjxD1XnoycQuhz903Nwa-77" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="sjxD1XnoycQuhz903Nwa-13" value="">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sjxD1XnoycQuhz903Nwa-77" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontColor=light-dark(#CC0000,#CC0000);" value="&lt;b&gt;liscense 需开发&lt;/b&gt;" vertex="1">
          <mxGeometry height="30" width="60" x="530" y="60" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
